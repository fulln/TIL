#设计思想 #DDD #极客时间 

## 32｜CQRS（下）：CQRS还有哪些变化？

当我们遇到更高的并发性能需求时，就要考虑分布式程序和数据库了

### 应用服务分离

使用命令的并发请求相对比较少，而使用查询的并发请求却很多，需要横向扩展才能满足性能和可用性要求，那么就可以考虑拆成两个微服务了。我们把这种策略称为“应用服务分离”。

应用服务分离策略的好处是容易横向扩展，代价则是微服务的数量增加了，相应的运维和治理成本也就随之增加了。

### 数据库实例分离

数据库之间用“变更数据捕获”（change data capture, 简称 CDC）机制来同步。目前有多种开源或商业的方案可以选择。多数方案的原理都是由命令模型的数据库日志的变化来触发，然后同步到查询模型的数据库

### 为了实现命令进行的查询

CQRS 中的 Q（查询），指的其实是来自客户端的意图。也就是说，客户端的目的就是查询，才算是 CQRS 里的 Q，如果客户端的目的是增、删、改，在这个过程中发生的查询，一般不算是 CQRS 里的 Q。

## 33｜分析模式初探：怎样解决更复杂的问题？

### 什么是分析模式

1. 组织层级”（Organization Hierachies）模式 ： 灵活定义组织层级的关系。

在组织类型上加了一个一对多的自我关联，用来表示组织类型的上下级关系。准确地说，其实是组织类型下，组织之间的约束关系。这样，根据这个模型，可以在数据库里建一个组织类型表，这样就可以灵活定义组织层级关系，而不需要硬编码了。

2. 组织结构模式： 这种表示组织间多对多关联的方法

为了表达这种关联，在领域模型图里，我们也要把组织类型自身的多对多关联，拆成两个一对多关联，表示关联的实体可以叫做组织类型结构

3.  知识层模式

知识层里放的是定义性的对象，通常变化频率比较低。而操作层里的对象则用于日程业务操作，变化频率比知识层高得多。

4. 参与方模式

在某些场合，可以发现个人和组织具有共性，可以统称为参与方（party）。

5. 分层责任模式

人和组织的归属关系、组织和组织间的上下级关系，人与人之间的契约关系等等，可以统一看成是一种“责任”（accountability）关系。


领域驱动设计》侧重的是领域建模的普遍原理和通用模式，但对于不同业务领域中的具体模型介绍得还不多。我们想要掌握高级的建模技能，一个比较好的方式，就是看看前人已经处理过哪些复杂的领域，为这些领域建立的模型到底长什么样，建立这些模型的思考过程又是怎样的



## 地址

此文章为3月day1 学习笔记，内容来源于极客时间《[32｜CQRS（下）：CQRS还有哪些变化？ (geekbang.org)](https://time.geekbang.org/column/article/633224)》，《[33｜分析模式初探：怎样解决更复杂的问题？ (geekbang.org)](https://time.geekbang.org/column/article/634785)》
