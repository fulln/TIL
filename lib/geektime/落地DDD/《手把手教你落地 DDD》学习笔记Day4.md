#极客时间 #DDD 

## 课程内容

### 对聚合进行封装

  #### 数据库设计

**实现关联的两种方法**

##### 1.对象关联

可以从A领域对象找到B领域对象list，反之，也可以从B领域对象找到A领域对象。所以这是一个双向的对象关联
不然则是单向关联

##### 2.ID 关联

这是由A到B的单向关联，只不过A对象里只存了B的 ID，由B ID 找到B领域对象的工作只能留给领域服务或应用服务了

> 尽管从领域模型的角度，a和b之间是存在双向关联的，但在实现层面，由于两者之间没有对象关联，所以我们没有在图上画出表示关联的实线。

在领域模型里，所用属性都可以看作公有的，所以没有必要加权限修饰符。但实现模型是直接和代码对应的，一般要说明属性和方法的权限。这也是领域模型和实现模型的一个区别。
不论是对象关联还是 ID 关联，这几种方式都是同一个领域模型的不同实现。对于同一个领域模型，具体采用哪种实现关联的策略，取决于开发者的权衡，与业务人员没有直接关系。
领域模型和实现模型图的区别，实际上反映的是我们思维的两个不同层面，一个是概念层面（或者叫领域层面），另一个是实现层面。
这种思维方式对正确实践 DDD 很重要。在 DDD 的实践中，领域模型图是必需的，而实现模型图则是可选的

##### 2种关联方式的比较

基于对象的关联是传统面向对象编程的标准姿势。在这种方式下，对象之间通过自由地导航，共同完成任务。使用这种方式，大部分领域逻辑都可以在领域对象自身中完成，因此，只有少数情况才需要用到领域服务。

要在企业应用里大量使用对象关联，必须采用懒加载方式（也叫延迟加载）。也就是说，把一个对象从数据库中装入内存时，不装入关联的对象。只有当这个对象要用到某个关联对象的时候，才“透明地”把关联的对象装入内存。

我们采用一种折中的方式：**在聚合内部使用对象导航，跨聚合则使用 ID 导航。**

#### 代码的封装

聚合编程的一个重要原则：**聚合外部对象对非聚合根对象只能读，不能写，必须通过聚合根才能对非根对象进行访问。**
> 使用到的技术
> 包级私权限封装构造器和方法
> 返回不可变列表
> 用聚合根创建和访问非根对象等

##### 非聚合根的封装实现

因为聚合的不变规则往往不是单个对象能够处理的，所以这种规则必须由聚合根或者相应的领域服务负责验证。

非聚合根对象就不能由外界直接创建或修改

由于每个聚合都在同一个包里，把技能的 setter 设置成包级权限，就保证了只有在聚合内部的聚合根、领域服务、工厂等才能对他进行修改，外界只能读取。同样，技能对象的构造器也是包级权限，这样，就只有聚合内部才能创建技能对象了。

##### 聚合根对象实现

查询对象的方法

1. 查询单个
2. 查询列表

使用`Collections.unmodifiableList(experiences);` 外界就不能直接创建技能对象，而是把对象的“素材”作为参数传递给新增方法，从而在聚合根内部创建对象


## 课程地址

https://time.geekbang.org/column/article/621012




