---
dg-publish: true
title: 如何提升存储模块的性能和可靠性
createTime: 2023-08-01 23:36  
---
## 如何提升存储模块的性能和可靠性

### 存储性能优化有关的基础理论

- 内存读写的效率高于硬盘读写
- 批量读写的效率高于单条读写
- 顺序读写的效率高于随机读写
- 数据复制次数越多，效率越低

#### 缓存写和批量写

优化主要思路： **写到内存，等积攒了一批数据，在批量刷到硬盘**

##### 缓存写盘的主要策略

1. 按空间占用比例刷新
	1. 当内存系统的脏数据大于阈值，将数据刷新到硬盘
2. 按时间周期刷新
	1. 脏页存活时间（dirty_expire_seconds) 和刷新周期（dirty_writeback_centisecs）两个参数来配置
3. 程序手动刷新
	1. 手动调用fsync()

#### 随机写和顺序写

**顺序读写效率高于随机读写**
是针对硬盘的，是整个操作系统和硬盘的关系，而不是单文件和硬盘的关系。

##### 单文件写入和多文件顺序写入
多文件顺序写入，从硬盘角度看，就是随机写入

_**随机写和顺序写的核心就是数据存储结构的设计。**_


市面上2种方案：
1. 每个 Partition/Queue 单独一个存储文件，
2. 每台节点上所有 Partition/Queue 的数据都存储在同一个文件。
第一种方案，对单个文件来说读和写都是顺序的，性能最高，但当文件很多且都有读写，在硬盘层面就会退化为随机读写，性能会下降很多。第二种方案，因为只有一个文件，不存在文件过多的情况，写入层面一直都会是顺序的，性能一直很高。所以为了提高写的性能，我们最好使用第二种方案。

## 地址

此文章为8月day1 学习笔记，内容来源于极客时间《https://time.geekbang.org/column/article/672152》