---
dg-publish: true
title: 怎么保证数据库的高可用、高性能
createTime: 2023-08-02 23:31  
---
##  怎么保证数据库的高可用、高性能

### 查询缓存

查询缓存不一定带来查询性能提升。如果你的查询每一次对应的 SQL 都不一样，那么查询缓存反而会降低查询性能。

提高数据库可用性、性能作为你提高整个系统的可用性、性能的一环。
### 整体方案

#### 参数调优

![](https://static001.geekbang.org/resource/image/cf/e3/cfbb238yy09e78e4781ca9301eabaee3.png?wh=1920x743)

innodb 缓冲池的大小，用于缓存表和索引，也包括插入数据缓冲，增加这个值可以减少磁盘 IO。

**innodb_buffer_pool_size**
实践中应该尽可能调大这个参数。如果数据库所在的机器内存比较大，那么可以调整到整个内存的 70% 或者 75%。但是也要小心这个参数过大，物理内存不足，容易触发操作系统 swap。

**innodb_buffer_pool_instances**
1. 要是整个 MySQL InnoDB 引擎内部只有一个缓冲池，所有查询都访问它，那么并发竞争会十分厉害。
2. 可以考虑启动多个缓冲池实例，具体多少个就由 innodb_buffer_pool_instances 这个参数指定。显然这个数字越大，并发竞争就越小。
3. innodb_buffer_pool_instances 大于 1 的情况下，innodb_buffer_pool_size 不能小于 1G。一般我建议在 8G 以内设置成 2 就可以，如果大于 8G 那么可以设置成 4。

**query_cache_min_res_unit**
缓存功能适合那种耗时并且重复执行的查询，而实际上这一类的查询并不多。另外一个理由是，数据库本身就容易成为性能瓶颈，那么完全可以让应用自己去做缓存，减轻数据库的负担。

### 读写分离

> 单库引入读写分离，并不是特别复杂。不过这个过程中要小心主从延迟问题。比如说原本有一个业务是在更新之后立刻读数据，那么就会读到更新后的值。但是如果修改成读从库，就可能还是会读到更新前的值，导致业务出错。在改造业务的过程中要小心这种场景。


### 分库分表

1. 为什么要分库分表？
2. 分库分表中间件选型，你只需要回答你们公司使用的分库分表中间件的优缺点就可以了。如果你对分库分表中间件没有任何了解，那么无脑使用 ShardingSphere 也行。
3. 容量规划，也是上节课的内容。
4. 数据迁移，是前面第 15 讲的内容。
5. 分库分表键选择，前面第 19 讲学过。主键生成策略，并且要能解释清楚这种决策的理由。
6. 分库分表之后的事务问题，前面第 14 讲我们也讨论过，包括在服务层面上解决事务，例如 TCC、SAGA，又或者依赖于分库分表中间件提供的策略，比如说延迟事务。
7. 分库分表中一些特殊查询的处理，最主要的就是分页查询，你在前面第 17 讲也学过了。

# 地址

此文章为8月day2 学习笔记，内容来源于极客时间《https://time.geekbang.org/column/article/683232》