---
dg-publish: true
title: 分库分表容量预估
createTime: 2023-07-31 23:46  
---

## 分库分表容量预估

利用流量复制和重放来做数据校验

### 分区表

分区表就是把一张表分成几块，每一块存储在磁盘的一个地方，一块也叫做一个分区。比如典型的按月分区，是指每个月产生的数据在一个独立的区域。数据库可以单独处理某一块，也可以多块一起处理。

![](https://static001.geekbang.org/resource/image/32/10/328f7d46c31fd45e9ba55b21f3dc2310.png?wh=1920x790)


### 2 的幂与数据迁移

1. 基本上扩容都是选择容量翻倍。这其实是因为 2 的特性，在使用哈希取余来进行分库分表的时候，可以使用位运算来计算余数，非常高效。
2. 在扩容的时候，如果扩容为原来的 2 倍，那么只需要迁移一半的数据

#### 为什么分库分表？

> 一句话总结分库分表，那就是数据库本身出现了性能问题，而且这些性能问题已经没办法通过 SQL 优化、索引优化之类的手段来解决了。

从硬件资源、并发、数据量三个引起性能瓶颈的角度去分析

对于写瓶颈来说，分区表可以缓解问题，而读写分离几乎没有效果，比如频繁地增删改操作。

对于硬件瓶颈来说，读写分离、分区表基本上也解决不了，比如写操作引发的网络带宽问题。

#### 分库还是分表？
1. 如果是数据库本身的硬件资源引起的性能瓶颈，那么就要分数据源。一句话来说，就是你得有更多的主从集群。
2. 如果是逻辑数据库引起的性能瓶颈，那么你就只需要在逻辑数据库这个层面进一步分库就可以了。
3. 如果是单表数据量过大、锁竞争等跟表维度相关的资源引发的性能问题，那么分表就可以了。

#### 容量估算
**现有数据和增长趋势**。紧接着你就要从这两个点出发解释具体怎么算。

#### 存量数据
部分不重要的、用不上的、历史悠久的数据，不如直接归档，或者放到大数据平台上。所以你真正需要计算的是那些还需要线上继续查询的数据的量。




# 地址

此文章为7月day31 学习笔记，内容来源于极客时间《https://time.geekbang.org/column/article/682824》
