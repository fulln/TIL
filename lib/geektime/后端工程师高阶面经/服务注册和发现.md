---
dg-publish: true
title: 服务注册和发现
createTime: 2023-06-20 23:06  
---

#geektime  #微服务 

## 服务注册发现高可用

1. 注册服务端崩溃检测
	1.  如果注册中心和服务端之间的心跳断了，认为服务端已经崩溃（心跳断了则服务端崩溃的判断并不能成立。）
	2.  心跳检测
		1. 注册中心尽快发现服务端宕机，需要有种检测机制判断服务端有没有崩溃，需要及时通知客户端。
		2. 当注册中心发现服务端心跳失败，认为服务端已经崩溃，立刻停止客户端使用。但是可能是网络偶发性，所以注册中心要继续保持心跳，多次失败认为服务端彻底不可用，但是如果恢复，注册中心要再次告诉客户端服务可用
		3. 心跳如果不重试，难以处理偶发性的网络不同的问题，如果重试，在重试的时间内，客户端可能有大量请求发送到服务端导致失败
		4. 需要客户端来做容错
2. 客户端容错
	1. 尽量在注册中心或者服务端节点出现问题的时候，依旧保证请求能够发送到正确的服务端节点上。
	2. 一般的策略是客户端在发现调不通之后，应该尝试换另外一个节点进行重试。如果客户端上的服务发现组件或者负载均衡器能够根据调用结果来做一些容错的话，那么它们应该要尝试将这个节点挪出可用节点列表，在短时间内不要再使用这个节点了。后面再考虑将这个节点挪回去。
	3. 最坏的情况下，延时等于服务端和注册中心心跳间隔加上注册中心通知客户端的时间。大多数时候，注册中心通知客户端都是很快的，在毫秒级以内。因此可以认为服务端和注册中心的心跳间隔就是这个延时。
	4. 客户端和服务端之间的网络有问题，导致客户端调用不通
		1. 客户端也要朝着那个疑似崩溃的服务端节点继续发送心跳。如果心跳成功了，就将节点放回可用列表。如果连续几次心跳都没有成功，那么就不用放回去了，直接认为这个节点已经崩溃了。
3. 注册中心选型
	1. 要考虑因素非常多
		1. 中间件成熟度、社区活跃度、性能等因素
	2. CAP问题
		1. C：Consistency，数据一致性A：Availability，服务可用性P：Partition-tolerance，分区容错性
		2. 在注册中心选型上，重要的是 CAP 原理中应该选择 AP，比如说 Eureka，又或者 Nacos 启用 AP 模式。
# 地址

此文章为6月day20 学习笔记，内容来源于极客时间《 https://time.geekbang.org/column/article/668434 》

