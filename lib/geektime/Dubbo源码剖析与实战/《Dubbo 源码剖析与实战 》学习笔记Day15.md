
## 课程内容

###  流量控制

#### 常见流量控制场景

1. 单机限流: 根据最细粒度的服务方法,设计出一个标准容量的参数,进行计数逻辑
2. 分布式限流: 在多台服务器下共享使用限流策略

#### 主要应用场景

第一，合法性限流，比如验证码攻击、恶意 IP 爬虫、恶意请求参数，利用限流可以有效拦截这些恶意请求，保证正常业务的运转。
第二，业务限流，比如 App 案例中的权限系统，参考接口的业务调用频率，我们要合理地评估功能的并发支撑能力。
第三，网关限流，比如 App 案例中的网关，当首页加载流量异常爆炸时，也可以进行有效的限流控制。
第四，连接数限流，比如利用线程池的数量来控制流量。

### 服务认证

#### 常见服务认证手段

1. 真假鉴定: 在客户端发送数据的时候我们添加一个 TOKEN 字段，然后，服务端收到数据先验证 TOKEN 字段值是否存在，若存在则认为是合法可信任的请求，否则就可以抛出异常中断请求了。
2. 鉴定篡改:对数据进行加密加签等操作

#### 常见实用场景

第一，系统内应用之间的调用，这种基本上是一个系统群或者系统域，里面有很多应用，应用之间的调用可以考虑服务认证。
第二，系统间不同应用的调用，这种有点像不同部门或不同系统域之间的应用调用，有点跨组织的概念，往往会考虑服务认证。
第三，系统内外不同系统的调用，这种有点像内部系统与外部公网之外的系统进行调用，一旦谈到公网，各种安全因素一定少不了，因此就更有必要考虑认证了。

###  配置加载顺序

调用流程整体分为三大块，**先取方法级别的参数，再取服务级别的参数，最后取实例级别的参数；在每一块的内部按照先取消费方，再提供方的顺序读取参数。**

![[Pasted image 20230130203554.png]]


主要有四个层级关系：
- System Properties，最高优先级，我们一般会在启动命令中通过 JVM 的 -D 参数进行指定，图中通过 -D 参数从指定的磁盘路径加载配置，也可以从公共的 NAS 路径加载配置。
- Externalized Configuration，优先级次之，外部化配置，我们可以直接从统一的配置中心加载配置，图中就是从 Nacos 配置中心加载配置。
- API / XML / 注解，优先级再次降低，这三种应该是我们开发人员最熟悉不过的配置方式了。
- Local File，优先级最低，一般是项目中默认的一份基础配置，当什么都不配置的时候会读取。

##### 配置官网文档地址
https://dubbo.apache.org/zh/docs3-v2/java-sdk/reference-manual/config/principle/#32-%E5%B1%9E%E6%80%A7%E8%A6%86%E7%9B%96

#### 服务注册

新版本包含了应用级注册和接口级注册。提供方这边默认情况下，不但会进行应用级注册，还会进行接口级注册；而在消费方这边，有个智能决策的兼容过度方案，优先使用应用级注册信息。

可以通过在消费方设置只消费接口级注册

```json
# 在消费方工程中的 resources/dubbo.properties 增加只订阅接口级注册
dubbo.application.service-discovery.migration=FORCE_INTERFACE
```

或者在provider方设置只进行接口级注册

```json

# 在提供方工程中的 resources/dubbo.properties 增加只进行接口级注册
dubbo.application.register-mode=interface
```

## 课程地址

[09｜流量控制：控制接口调用请求流量的三个秘诀](https://time.geekbang.org/column/article/614130)

[10｜服务认证：被异构系统侵入调用了，怎么办？](https://time.geekbang.org/column/article/615318)

[11｜配置加载顺序：为什么你设置的超时时间不生效？](https://time.geekbang.org/column/article/615345)