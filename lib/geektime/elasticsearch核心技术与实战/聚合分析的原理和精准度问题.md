---
dg-publish: true
title: 聚合分析的原理和精准度问题
createTime: 2023-06-16 23:45  
---

## shard_size 设定

- 调整shard size 大小，降低 doc_count_error_upper_bound 来提升准确度
	- 增加整体计算量，提高准确度，但是会降低响应时间
- shard size 默认大小设定
	- shard size  = size * 1.5 + 10

```http
  

GET kibana_sample_data_flights/_search

{

  "size": 0,

  "aggs": {

    "weather": {

      "terms": {

        "field":"OriginWeather",

        "size":5,

        "show_term_doc_count_error":true

      }

    }

  }

}
```