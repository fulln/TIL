---
dg-publish: true
title: kafka稳定性与降本
createTime: 2023-05-26 16:01  
---

1. 部署
	1. zk
	2. kraft

2. 节点,硬盘成本占比较高
3. 常见稳定性问题
4. 通过弹性计算架构提供稳定性
	1. 计算层
	2. 存储层

### kafka计算弹性

1. 现有模型是不支持快速弹性
2. 当前社区架构提升稳定性的思路
	1. 预防
	2. 快速恢复
> 升级节点规格
> 分区禁写
> 但是有损

### **无感知**

- 迁移少量的老数据
	- 冷热数据分离
- 计算存储分离


1. 快速挂载
	1. 完全不管元数据
2. 使用分布式文件系统
	1. 有部分同步的问题
3. 计算存储分离架构
	1. proxy方案
		1. 内核不用改动
	2. 底层存储切换远端引擎
	3. 内核支持
		1. 方案改动大, 对现有系统不友好,如阿里云盘古

### 弹性本地存储

- 云盘+ 运营调度系统
	- 目标是发现快速发现需要扩容or缩容
- 多云盘+ 多目录
	- 数据倾斜的问题要通过调度系统处理

## 弹性远程存储架构

1. 通过更廉价的存储
	1. kafka 分层存储
		1. 开启分层后,先写本地在写远端,消费也要从远端拉取数据,读到本地.
			1. 隔离
			2. 性能
			3. 稳定性
			4. ...

### 集群自均衡

节点rebalance

### 限流策略和机制的设计
- 全局限流

## 跨区容灾
1. 同时写2个可用区
2. 一般不建议跨区部署

## 混沌工程kafka应用

### 稳定性优先下的成本优化

