---
dg-publish: true
title: 实时社区的海量信息分发实践
createTime: 2023-05-27 09:20  
---
### 无限成员,海量消息如何分发

1. 架构
	1. 访问接入
	2. 内部服务
		1. 主节点和扩展节点
		2. 有限的扩散模型
		3. 动态的投递模型
	3. 数据存储
### 消息分发场景遇到的问题

服务伸缩:
1. 一般半状态:
2. 弱化状态:
	1. 成本问题导致无法完全无状态
		1. 热点数据缓存
		2. 以用户为落点

在线消息爆炸:
1. 消息驱动
2. 增量拉取
3. 订阅式会话驱动
	1. 单个会话中, 不需要实时拉取出来.

海量离线消息:
1. 会话驱动
	1. 只拉统计数据?
2. 消息断档
3. 历史消息补全


### 消息分发后遗症

用户会话的实时构建:
1. 80w人,消息量的cpu,网络压力很大.
	1. 实时会话
		1. 读更新
		2. 写更新
			1. 用户相关特性需要写更新
		3. 主节点处理消息索引(redis)
		4. 扩散节点处理消息分发


