---
dg-publish: true
title: 演进式架构
createTime: 2023-05-27 09:23  
---

###  业务出海的技术挑战

1. 效率
	2. 云,跨云,多数据中心
2. 稳定
	1. 专线可靠性的问题
3. 性能
	1. 用户访问距离远
	2. 内网访问延时高
### 海外架构的演进

1. 起步
	1. 要求:快速,成本低
	2. 本地化存储
2. 发展
	1. 数据中心专线打满
	2. 出口收费
	3. 独立部署
		1. 1主多从
3. 壮大:
	1. 访问距离远
	2. 带宽容量有限
	3. 网络丢包常见

集群形态:
1. 隔离,独立
2. 统一,联邦

配置下发做到多集群:
	1. 每个配置独立/ 所有一致
		1. 设置单发还是多发
		2. 配置存数据库, 多发的时候通过旁路同步到其他集群
跨集群的服务发现:
	1. gateway 模式
		1. 出站网关: 虚拟注册
			1. 经过出站gateway 转发到入站gateway, 再到实际后端
			2. 增加了链路长度和稳定的问题
			3. 适合多集群多网络
		2. 入站网关: 请求代理
	2. 多注册:
		1. 除了注册到本地集群,还注册到区域集群
		2. 对注册端有侵入,调用端透明
	3. 多订阅:
		1. 和注册的方式逻辑相反

最终采用了多订阅模式:
1. 性能问题: 订阅效率差,订阅串行,启动耗时很长
	1. 对订阅做切分,并行处理

调用链路跨云上报 -> 跨云查询
所有集群都是上报到同一个trance集群中.

1. 数据传输小
2. 但是不支持复杂计算

消息复制:
replication
- 本地消费
- topic全局唯一
- src和dest 一致

就近访问:
1. CDN
2. DNS就近介入
3. 同区域调用

数据同步工具:
1. 事件驱动
2. 冷热启动

图片处理服务
1. serverless

数据一致性保障:
unit模式
- 本地读写
- 用户维度的单元调度?
copy模式
- 单点写,多点读

多集群的统一观测能力:

### 总结
