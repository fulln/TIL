---
createTime: 2024-03-15 18:04
tags:
  - mysql
  - 索引
  - innodb
  - hashTable
---
## 基本概念

索引在数据库中起到比较关键的作用,涉及到事务,搜索速度等一系列的影响Í
### 聚簇索引和非聚簇索引
- 非聚簇索引
	- 在树里面的叶子结点的val值里存主键，然后通过回表的方式定位到具体行所在的位置
	- 在创建非唯一键索引的b+树的时候可能会在目录树上加一个主键作为唯一区分
	- 所以可以加上一个主键的条件判断进行sql的优化
- 聚簇索引
	- 规则
		- 1.根据主键查询的时候，不用回行（数据就在主键节点下
		- 2.如果遇到不规则数据插入，会导致频繁页分裂
	- 优缺点
		- 1.数据访问更快，因为聚簇索引将索引和数据保存在同一个B+树中，因此从聚簇索引中获取数据比非聚簇索引更快
		- 2.聚簇索引对于主键的排序查找和范围查找速度非常快
		- 3.插入速度严重依赖于插入顺序，按照主键的顺序插入是最快的方式，否则将会出现页分裂，严重影响性能。因此，对于InnoDB表，我们一般都会定义一个自增的ID列为主键
		- 4.更新主键的代价很高，因为将会导致被更新的行移动。因此，对于InnoDB表，我们一般定义主键为不可更新。
		- 5.二级索引访问需要两次索引查找，第一次找到主键值，第二次根据主键值找到行数据
## 常见索引模型
1. hash表
	  - 冲突后使用链表处理
	  - 优缺点
			- 新增很快
			- 区间查询速度慢
			- 等值查询速度快
 2.  有序数组
	  - 优缺点
		- 查询都很快
		- 更新数据成本高
	  - 只适用静态存储引擎
 3. 搜索树
	  - N叉搜索树
		- 根据数据块大小来决定其高度,整数型默认是1200
			 - MySql默认一个节点的长度为16K，一个整数（bigint）字段索引的长度为 8B,另外每个索引还跟着6B的指向其子树的指针；所以16K/14B ≈ 1170
			 - 第二层大概 1200页，所以 1200 * 16KB = 20M，内存还是放得下的。第三层大概144W页，要144w * 16kB =23G, 都放内存就不合适了。
	  - 优缺点
		- 读写性能优异
			 - 读写空间复杂度为O(nlogn)
		- 适配磁盘的访问模式
4.  跳表
	- redis
5. [[code/tech/LSM树详解|LSM树详解]]
	- kv引擎数据库
## 模型对应引擎

### INNODB 

 1. 每一个索引都对应一个b+树
	  - 能很好配合磁盘读写,减少单次查询对磁盘的读写
 2. 类型
	  - 主键索引
			- 聚簇索引
	  - 非主键索引
			- 二级索引
			- 普通索引查询,先搜索当前索引,再搜索主键索引,这种过程称之为回表
#### 优化
- 覆盖索引
	- 查询的值已经在叶子节点上,这时候不需要回表操作
	- 索引冗余
- 最左前缀原则
	- 联合索引的最左 N 个字段
	- 字符串索引的最左 M 个字符
- 联合索引构建原则
	- 复用
		 - 如果通过调整顺序，可以少维护一个索引，那么这个顺序往往就是需要优先考虑采用的
	- 空间
	- 考虑索引下推
		 - 在索引遍历过程中，对索引中包含的字段先做判断，直接过滤掉不满足条件的记录，减少回表次数。
- 索引选择异常与处理
	- 1. 使用force index 强行选择一个索引
	- 2. 考虑修改语句, 引导mysql 使用期望引擎
		 - 比如加入多个排序字段
		 - 根据数据特征诱导下优化器
		 - 新建更合适索引或者删除不用索引
- 在建立索引时关注的是区分度，区分度越高越好。
	- 倒序索引和hash索引不支持范围查询
	- 前缀索引和覆盖索引
		 - 使用前缀索引，定义好长度，就可以做到既节省空间，又不用额外增加太多的查询成本
		 - 使用前缀索引就用不上覆盖索引对查询性能的优化了
- 不走索引的几个场景		
	- 条件字段函数操作: 对字段进行条件函数不会走索引
	- 隐式类型转换:  在 MySQL 中，字符串和数字做比较的话，是将字符串转换成数字。
	- 隐式字符编码转换:  utf8 ->UTF8mb4,相当于用了CONVERT()函数
						
			 