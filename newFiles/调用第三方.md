---
dg-publish: true
title: 调用第三方
createTime: 2023-07-05 21:18  
---

## 一致性抽象
1. 屏蔽不同第三方平台 API 之间的差异。
2. 提供客户端治理，即提供调用第三方平台 API 的重试、限流等功能。
3. 提供可观测性支持。
4. 提供测试支持。

### 客户端治理

客户端治理有两个关键措施：限流和重试


### 可观测支持

接入 Prometheus 和 SkyWalking 等工具。同时，你还要考虑提供便利的查询工具，让你自己和你的业务方都能够快速定位问题。

*告警*

当监控系统发现第三方平台突然不可用了，那么它会发出两个告警
一个是告诉你出事了；
另外一个则是通知业务方第三方平台目前不稳定，那么业务方就需要确认对他们业务的影响范围，以及他们是否需要启动一些容错措施。

### 测试支持

提供mock服务

如果第三方平台还有回调机制，并且你在收到回调之后还要通知业务方，那么你还需要模拟这个回调。比如说微信支付接口后面会回调你的一个接口，告知你支付结果。

#### 压测支持

1. 模拟第三方的响应时间。
2. 模拟触发你的容错机制。如果你采用了同步转异步这种容错机制，那么你需要确保在流量很大的情况下，你确实转异步了；如果你采用的是自动切换第三方，那你也要确保真的如同你设想的那样真的切换了新的第三方。
3. 流量分发。如果是在全链路压测的情况下，压测流量你会分发到 mock 逻辑，而真实业务请求你是真的调用第三方。

# 地址 

此文章为7月day5 学习笔记，内容来源于极客时间《https://time.geekbang.org/column/article/672238》



