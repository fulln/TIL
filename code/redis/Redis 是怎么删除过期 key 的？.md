---
dg-publish: true
title: Redis 是怎么删除过期 key 的？
createTime: 2023-11-15 09:28
tags:
  - redis
---
## Redis 是怎么删除过期 key 的？

  
Redis删除过期key的方式有两种：**被动删除和主动删除**。

被动删除是指当客户端尝试访问一个key时，如果发现该key已经过期，Redis会将其删除。这种方式是一种半懒惰的机制，只有在访问key时才会判断是否过期并删除。这种实现简单，但是如果一个key从未被访问过，它将一直占用内存，造成资源浪费。

为了解决这个问题，Redis引入了主动删除机制。**Redis会定期随机选择一些带有过期时间的key进行检查，如果发现过期的key，就会将其删除**。具体来说，Redis每秒会执行以下操作：**随机选择20个带有过期时间的key，删除所有过期的key；如果超过25%的key已经过期，重新执行第一步。** 这是一个简单的概率算法，Redis会不断删除过期的key，直到过期的key所占的比例低于25%。

需要注意的是，如果一个key被重命名，过期时间会被转移到新的key上。另外，通过使用EXPIRE命令可以设置key的过期时间，使用PERSIST命令可以取消key的过期时间。

总结起来，**Redis删除过期key的方式是通过被动删除和主动删除相结合的机制，确保过期的key能够及时被删除，避免资源浪费。**